events {}

http{
upstream appserver {
    server 172.17.0.9:8080;
}


server {
    listen 4433 ssl;
    ssl on;


    if ($ssl_client_verify != "SUCCESS") { return 403; }
    ssl_client_certificate cert/server.crt;
    ssl_certificate_key     certs/server.key;
    ssl_password_file       certs/password.txt;
    ssl_verify_depth 2;
    ssl_verify_client on;
    ssl_client_certificate  certs/ca.crt;


    location / {
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header SSL_Client $ssl_client_s_dn;
        proxy_set_header SSL_Client_Verify $ssl_client_verify;
        proxy_pass http://172.17.0.9:8080;
    }
}



}
